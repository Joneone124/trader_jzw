import json
import time

from binance.um_futures import UMFutures
import requests
import pandas as pd
import matplotlib.pyplot as plt
from pandas.plotting import table
from PIL import Image, ImageDraw, ImageFont
import hashlib, base64

from func.open_interest_monitor import monitor
from func.wecaht import alert
um_futures_client = UMFutures()
response_15m = um_futures_client.open_interest_hist('DODOBUSD', "15m", **{"limit": 5})
response_3m = um_futures_client.open_interest_hist('DODOBUSD', "3m", **{"limit": 1})
print(response_15m)
print(response_3m)

# print(response_2h)

# file_image = open('pic.jpg', 'rb').read()
# is_f = base64.b64encode(file_image)  # 根据企微api的要求，要把图片编成 base64 编码
# md5 = hashlib.md5(file_image)  # 也是根据企微api要求来编码
# data = {
#     'msgtype': 'image',
#     'image': {
#         'base64': is_f.decode('utf-8'),
#         'md5': md5.hexdigest()
#     }
# }
#
# requests.post('https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=09671de5-6d1c-4260-84da-70f0f1b6530c', data=json.dumps(data))

# cate = []
# rate = []
#
# for i in range(100):
#     cate.append(i)
#     rate.append(i)
#
# xls = pd.DataFrame({'币种': cate, '波动幅度': rate}, index=None)
#
# plt.rcParams['font.sans-serif'] = ['Microsoft YaHei']  # 显示中文
# fig = plt.figure(figsize=(4, 10), dpi=300)  # 图片的长、宽、像素
# ax = fig.add_subplot(111, frame_on=False)  # 111表示只画一张图
# ax.xaxis.set_visible(False)
# ax.yaxis.set_visible(False)
# table(ax, xls, loc='center')
# plt.savefig('pic.jpg')
# alert_dic = {'a':5, 'b':2, 'c':7, 'd':1}
#
# s = sorted(alert_dic.items(), key=lambda item: item[1], reverse=True)
# print(s)
# cate = s.keys()
# rate_temp = s.values()
#
# rate = []
# for i in rate_temp:
#     rate.append(str(round(i, 2)) + "%")
#
# print(cate)
# print(rate)
# import numpy as np
# arr = [1,2,3,4,5]
# arr = np.array(arr)
# print(arr)
# print(type(arr))
# data = np.full(arr.shape,np.nan)
# print(data)

# a = [1,2,3]
# print(a)
# a[0] = 9
# print(a)

# alert_dic = [['IOTXUSDT', 49.161, 2.0248606286844573], ['LUNA2BUSD', 18.77, 2.020433898670464], ['XLMUSDT', 22.986, 2.0374516598138896], ['OMGUSDT', 28.554, 2.0128439702969616], ['BALUSDT', 11.162, 2.0210743587875815], ['DOGEBUSD', 40.414, 2.0127782456094154], ['XTZUSDT', 37.174, 2.0127919453777237], ['ARUSDT', 46.69, 2.005099120901957], ['DENTUSDT', 49.189, 2.0281881694771684], ['GALAUSDT', 63.439, 2.0232641333553096], ['ONTUSDT', 25.785, 2.010891254906466], ['ANTUSDT', 53.378, 2.0235969844490445], ['ADABUSD', 17.382, 2.0344954504203794], ['BNBUSDT', 19.717, 2.0222079739888374], ['TLMBUSD', 34.968, 2.0147298595496808], ['DARUSDT', 53.917, 2.0188613615167403], ['DEFIUSDT', 54.49, 2.021056914566102], ['ATOMUSDT', 10.899, 2.0153867446241764], ['CRVUSDT', 12.144, 2.014145284441439], ['ETHBUSD', 6.985, 2.0106764712934018], ['RAYUSDT', 19.187, 2.0186399664278016], ['COTIUSDT', 46.82, 2.0236087875515905], ['ALPHAUSDT', 72.894, 2.016057034154611], ['AXSUSDT', 70.976, 2.002076424982976], ['ATAUSDT', 109.546, 2.019040906004773], ['XRPBUSD', 15.383, 2.0725165657980047], ['KNCUSDT', 64.519, 1.999998912013581], ['RENUSDT', 40.74, 2.015341865172771], ['C98USDT', 38.412, 2.0338850198704423], ['DASHUSDT', 22.987, 2.014287777328703], ['KLAYUSDT', 67.185, 2.0300116089835334], ['ZECUSDT', 47.255, 2.0059408220816115], ['STMXUSDT', 35.526, 2.0075890355587136], ['CHRUSDT', 32.786, 2.0146988126523477], ['RLCUSDT', 67.424, 2.0416822776970296], ['IOSTUSDT', 17.117, 2.018790573669758], ['GMTUSDT', 8.847, 2.0270382583808946], ['RUNEUSDT', 3.082, 2.0288559205534744], ['ETHUSDT', 6.725, 2.0105434392035457], ['1INCHUSDT', 46.947, 2.0120701609304756], ['GALABUSD', 63.634, 2.023148867339049], ['CELOUSDT', 62.688, 2.0465108276410904], ['AAVEUSDT', 0.159, 2.0183715456002433], ['ANKRUSDT', 27.749, 2.0192761654581477], ['CTSIUSDT', 51.167, 2.0225547921805624], ['CVCUSDT', 35.125, 2.014468940023424], ['XMRUSDT', 7.393, 2.011674437678719], ['PEOPLEUSDT', 31.429, 2.053724828780002], ['ARPAUSDT', 43.988, 2.0233923446219313], ['LTCUSDT', 13.184, 2.021681973759997], ['ICPBUSD', 107.369, 2.0057914509853862], ['BTCBUSD', 14.586, 2.0234060538064034], ['BNBBUSD', 19.991, 2.0223814100271027], ['FILUSDT', 197.078, 2.027433981630861], ['LINKBUSD', 39.58, 2.0123766650432424], ['REEFUSDT', 37.982, 2.0448318328787423], ['BCHUSDT', 9.232, 2.0178135726880346], ['CTKUSDT', 115.265, 2.1463870806833087], ['ROSEUSDT', 53.888, 2.024346909136093], ['ONEUSDT', 50.136, 2.02058862870089], ['TOMOUSDT', 28.261, 2.0154999188747262], ['FLOWUSDT', 58.341, 2.0084067843005187], ['NEARUSDT', 28.834, 2.015389668376531], ['BTCUSDT', 14.458, 2.023335138400547], ['KAVAUSDT', 12.623, 2.0262486335248857], ['FTMUSDT', 33.851, 2.014956733030751], ['DOTBUSD', 73.035, 1.9983098676247601], ['OPUSDT', 164.384, 1.994784083374034], ['SCUSDT', 0.0, 1.9999999999999996], ['DYDXUSDT', 52.191, 2.004471710263777], ['SXPUSDT', 34.619, 2.0135116997873], ['HBARUSDT', 25.831, 2.020482981400055], ['ZRXUSDT', 96.666, 1.9813754448014382], ['ENSUSDT', 16.104, 2.0326694641516063], ['SOLUSDT', 17.842, 2.0479906319817416], ['1000XECUSDT', 11.553, 2.0119800118763056], ['XRPUSDT', 15.358, 2.072679182147251], ['BELUSDT', 102.364, 2.017906782597337], ['ADAUSDT', 17.228, 2.0346461356842327], ['JASMYUSDT', 55.749, 2.0273317716485515], ['FLMUSDT', 252.008, 2.0782060575951875], ['SKLUSDT', 74.72, 2.0332910758245584], ['OCEANUSDT', 44.165, 2.011797077673902], ['LTCBUSD', 13.441, 2.0214334380321324], ['ICPUSDT', 0.0, 2.0000000000000004], ['SANDBUSD', 11.058, 2.0246113103831136], ['ALICEUSDT', 32.34, 2.0123926987885628], ['DOGEUSDT', 40.147, 2.0127763582441243], ['DUSKUSDT', 52.382, 2.0078197285362904], ['CHZUSDT', 70.093, 2.0043163631173315], ['BTCUSDT', 14.458, 2.023335138400547], ['VETUSDT', 32.419, 2.024249811972019], ['BLZUSDT', 66.062, 2.021107373185561], ['MASKUSDT', 43.645, 2.041767666764943], ['RVNUSDT', 56.696, 2.0242410373252486], ['SUSHIUSDT', 10.81, 2.0292029077437763], ['APEUSDT', 3.976, 2.019846602145783], ['ICXUSDT', 47.554, 2.029152403015972], ['STORJUSDT', 54.354, 2.004086131053259], ['ENJUSDT', 36.73, 2.0229268534437796], ['HNTUSDT', 35.882, 2.022007155877502], ['AVAXBUSD', 18.22, 2.023486391563956], ['ANCBUSD', 8.572, 2.0257959280915814], ['GALUSDT', 152.3, 2.117593257444592], ['DGBUSDT', 40.753, 2.0190415345632924], ['LINAUSDT', 46.102, 2.011762058914479], ['IOTAUSDT', 46.066, 2.021152827528036], ['NEOUSDT', 31.15, 2.0141747774567653], ['LPTUSDT', 46.332, 2.0045020228815136], ['ALGOUSDT', 25.751, 2.0204254127601406], ['UNIUSDT', 6.107, 2.007100763015496], ['TRBUSDT', 236.4, 2.0599003889259135], ['MTLUSDT', 43.731, 1.999485394421951], ['GMTBUSD', 8.965, 2.027243735436766], ['WOOUSDT', 84.078, 2.134417464910966], ['TRXBUSD', 12.117, 2.009514277183417], ['EGLDUSDT', 37.179, 2.016651893012789], ['GALBUSD', 152.289, 2.117515458350905], ['FTTUSDT', 32.546, 2.0303628568737837], ['TRXUSDT', 12.131, 2.0094813083210212], ['NKNUSDT', 48.955, 1.9882010577526132], ['RSRUSDT', 50.361, 2.0543704748705287], ['DOTUSDT', 72.893, 1.9984882189503734], ['AUDIOUSDT', 31.616, 2.0237196391166843], ['BANDUSDT', 66.734, 2.0228460849402157], ['ZILUSDT', 25.673, 2.005229293850879], ['LITUSDT', 125.98, 2.061583433446905], ['BAKEUSDT', 60.662, 2.0068864130311654], ['LINKUSDT', 39.21, 2.0127669717404006], ['WAVESUSDT', 16.237, 2.0147145886228475], ['SOLBUSD', 17.849, 2.048264435116809], ['BATUSDT', 35.843, 2.019759449564972], ['NEARBUSD', 28.888, 2.015340349434677], ['YFIUSDT', 219.761, 1.9981650195163734], ['BNXUSDT', 11.73, 1.9990552989138068], ['AVAXUSDT', 18.163, 2.0233942121176804], ['GTCUSDT', 32.988, 2.032449915503354], ['MANAUSDT', 27.037, 2.0399102755333343], ['APEBUSD', 4.072, 2.0202893816255885], ['ETCUSDT', 21.475, 2.0116019235234437], ['UNFIUSDT', 120.681, 1.9875704333530917], ['MKRUSDT', 40.12, 2.0220018375252877], ['COMPUSDT', 35.732, 2.023409564665613], ['XEMUSDT', 26.283, 2.0211471178189417], ['ETHUSDT', 6.725, 2.0105434392035457], ['SANDUSDT', 10.68, 2.0241267981119155], ['IMXUSDT', 131.979, 2.022339625197711], ['GRTUSDT', 90.724, 2.0411139345582945], ['QTUMUSDT', 15.754, 2.004288812097542], ['DODOBUSD', 58.043, 2.022261585936066], ['OGNUSDT', 52.057, 2.0113496103286543], ['KSMUSDT', 27.926, 2.0097477568940922], ['BTCDOMUSDT', 2.401, 2.0047145857277635], ['CELRUSDT', 46.578, 2.03274311677275], ['BTSUSDT', 46.409, 2.0032302351842572], ['ZENUSDT', 46.984, 2.017032785229254], ['LRCUSDT', 44.7, 2.025054945577052], ['THETAUSDT', 34.105, 2.020544047712368], ['1000SHIBUSDT', 35.48, 2.018679830920706], ['EOSUSDT', 12.94, 2.027660579175884], ['SRMUSDT', 13.436, 2.0212679953473476], ['FTMBUSD', 34.152, 2.0150693451977806], ['1000LUNCBUSD', 1.569, 2.014653564040644], ['WAVESBUSD', 16.543, 2.01438651922718], ['HOTUSDT', 51.442, 2.0237668001805194], ['API3USDT', 52.381, 2.0469617467313697], ['FTTBUSD', 32.919, 2.030478672007869], ['TLMUSDT', 0.0, 2.0], ['MATICUSDT', 12.85, 2.0180368866789946], ['SNXUSDT', 8.526, 2.014654505998114], ['SFPUSDT', 22.126, 2.0075496380760645]]
# sort_list = alert_dic.sort(key=lambda x: float(x[0]))
#
# print(sort_list)
file = open('data/list_little.txt', 'r')
content_little = file.readlines()
print(content_little[0][0:-1])